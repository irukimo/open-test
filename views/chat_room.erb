<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title><%=TITLE%></title>

    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/homepage.css">
    <link rel="stylesheet" type="text/css" href="css/categ.css">
    <link rel="stylesheet" type="text/css" href="css/chat_room.css">
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="js/basic_display.js"></script>

    <style type="text/css">
    #timesleftbig{
      padding-left: 5pt;
      color: #737373;
      font-size: 12pt;
    }
    #shufflebtn, #timesleft{
      display: inline-block;
    }
    #timesleft{
      font-size: 15pt;
    }
    #coinicon{
      display: inline-block;
    }


    #pbtn, #rbtn, #sbtn, #fbtn{
      min-height: 60px;
      font-size: 15pt;
      background-color: #474747;
      color: #FFFFFF;
      text-align: left;
    }

    .carousel-control.left, .carousel-control.right{ 
      background: none !important; 
      filter: progid:none !important; 
    }
    </style>


    <script>

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52817227-4', 'auto');
  ga('send', 'pageview');
    </script>

  </head>
<!-- NAVBAR
================================================== -->
  <body>
    


    <!-- Marketing messaging and featurettes
    ================================================== -->
    <!-- Wrap the rest of the page in another container to center all the content. -->

    <div class="container marketing">

  <!-- <h1>Records</h1> -->
<br>
   <div class="row header">
      <div class="col-xs-3 col-md-1 goBack" onclick="goBack()">
        <div style="width:60px;height:7px;"></div>
        <img src="/img/arrow.png" alt="Smiley face" width="60" height="40">
      </div>
      <div class="col-xs-9 col-md-9">


        <!-- if he is not anonymous -->
            <div class="col-xs-12 col-md-12 profile_icon not_anon top_icon">
                <div class="profile_pic" style="background-image: 
               url('/img/wen.jpg')">
                </div>
            </div>
        <!-- if he is anonymous -->
<!--             <div class="col-xs-3 col-md-9 profile_icon anon top_icon">
                <div class="profile_pic">
                </div>
            </div> -->
          <div class="name"><%=@display_name%></div>

      </div>
   </div>

  <!-- <h1>Records</h1> -->
<br>
 <div class="row">
    <div id="room_background" class="col-xs-11 col-md-3">

    <div id="question_bundle" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <font color="#be0d0d">
    <ol class="carousel-indicators">
      <li data-target="#question_bundle" data-slide-to="0" class="active"></li>
      <li data-target="#question_bundle" data-slide-to="1"></li>
      <li data-target="#question_bundle" data-slide-to="2"></li>
    </ol>
  </font>

    <!-- Wrapper for slides -->
    <!-- <center><%= @is_author ? "你" : "他"%>比了<%=bundle[0]["option0"]%>跟<%=bundle[0]["option1"]%></center> -->
    <div class="carousel-inner">
      <% has_active = false 
         bundle.each do |hash| 
          unless has_active
      %>
          <div class="item active">
        <% has_active = true
           else %>
          <div class="item">
        <% end %>
        <div class="history_compare">
          <div class="row">
              <center><div class="history_question"><%=hash["question"]%></div></center>
              <div class="col-xs-6 col-md-6">
                <center><%=hash["option0"]%></center>
              </div>
              <div class="col-xs-6 col-md-6">
                <center><%=hash["option1"]%></center>
              </div>
          </div>
          <div class="row">
              <div class="col-xs-6 col-md-6">
                <center>
                  <div class="chosen_person">他</div>
                  <div class="chosen_person">你</div>
                </center>
              </div>
              <div class="col-xs-6 col-md-6">
                <center><div class="chosen_person">你</div></center>
              </div>
          </div>
        </div>
      </div>
      <% end %>
      
    </div>

    <!-- Controls -->
    <a class="left carousel-control" href="#question_bundle" role="button" data-slide="prev">
      <span class="glyphicon glyphicon-chevron-left"></span>
    </a>
    <a class="right carousel-control" href="#question_bundle" role="button" data-slide="next">
      <span class="glyphicon glyphicon-chevron-right"></span>
    </a>
  </div>

      
      
      <!-- template of my message -->
      <div class="row" id="my_message" style="display:none;">
          <div class="col-xs-2 col-md-2"></div>
          <div class="col-xs-9 col-md-9 self_message_box">
              <div id="message" class="message"></div>
              <div id="time" class="time_stamp"></div>
          </div>
          <div class="col-xs-3 col-md-3 message_profile_icon <%= @anon ? "anon" : "not_anon"%>">
              <div class="message_profile_pic"></div>
          </div>
      </div>

      <!-- template of your message -->
      <div class="row" id="your_message" style="display:none;">
        <div class="col-xs-3 col-md-9 message_profile_icon <%= @anon ? "not_anon" : "anon"%>">
            <div class="message_profile_pic"></div>
              <!-- <div class="message_profile_pic" style="background-image: 
             url('/img/wen.jpg')">
              </div> -->
        </div>

        <div class="col-xs-9 col-md-9 message_box">
            <div id="message" class="message"></div>
            <div id="time" class="time_stamp"></div>
        </div>
      </div>

      <div class="messages">
        <%  time_now = Time.now
            Chat_History[chat_uuid].each do |chat| 
              time = sec_to_units(time_now - chat["time"])
              if chat["name"] == session[:tester]
        %>
        
        <!-- my message -->
          <div class="row">
              <div class="col-xs-2 col-md-2"></div>
              <div class="col-xs-9 col-md-9 self_message_box">
                  <div id="message" class="message"><%=chat["message"]%></div>
                  <div id="time" class="time_stamp"><%=time%></div>
              </div>
              <div class="col-xs-3 col-md-3 message_profile_icon <%= @anon ? "anon" : "not_anon"%>">
                  <div class="message_profile_pic"></div>
              </div>
          </div>

        <%else%>
          <!-- your message -->
          <div class="row">
            <div class="col-xs-3 col-md-9 message_profile_icon <%= @anon ? "not_anon" : "anon"%>">
              <div class="message_profile_pic"></div>
                 <!--  <div class="message_profile_pic" style="background-image: 
                 url('/img/wen.jpg')">
                  </div> -->
            </div>

            <div class="col-xs-9 col-md-9 message_box">
                <div id="message" class="message"><%=chat["message"]%></div>
                <div id="time" class="time_stamp"><%=time%></div>
            </div>
          </div>

        <%end%>
        <%end%>
        
        
        <script>
          // reading
          var es = new EventSource('/chat_stream');
          es.onmessage = function(e) { 
            obj = $.parseJSON(e.data);
            var snippet;
            if(obj["name"] == "<%=session[:tester]%>") {
              snippet = $("#my_message").clone();
            } else {
              snippet = $("#your_message").clone();
            }
            snippet.find('#message').html(obj["message"]);
            snippet.find('#time').html(obj["time"]);
            snippet.css("display", "inline")
            $('.messages').append(snippet);
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
          };

        </script>

        </div>
        <!-- messages -->
        <a id="bottom"></a>

    </div>
</div>

  <form id="chatselectform" class="form-horizontal" role="form" action="chat_select" method="post">
      </form>
       <script type="text/JavaScript">
        //<![CDATA[
        function goBack(){
          var homeform = document.forms["chatselectform"];
          homeform.submit();
        }
           //]]>
        </script>

<br>
<br>
<br>
<br>

      <!-- FOOTER -->
      <div class="footer">
         <form>
          <input id='msg' placeholder='type message here...' />
        </form>
      </div>
      <script>  
      // $("html, body").animate({ scrollTop: $(document).height() }, "slow");
       // writing
          $("form").on('submit',function(e) {
            $.post('/chat', {msg: $('#msg').val()});
            $('#msg').val(''); $('#msg').focus();
            
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
            
            e.preventDefault();
          });
      </script>
    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <!-- Latest compiled and minified JavaScript -->
    
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>    
  </body>
</html>
